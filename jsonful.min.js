var JSONful=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(1),a=n(2),f=function(e){function t(){var e;r(this,t);for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];var u=o(this,(e=Object.getPrototypeOf(t)).call.apply(e,[this].concat(i)));return u.server=i[0],u._wait=50,u._queue=[],u._headers={},u.on("session",function(e){u._headers.session=e}),u}return i(t,e),u(t,[{key:"handle_responses",value:function(e,t){for(var n=0;n<e.length;++n)"object"===s(e[n])&&e[n].error?t[n].failure(e[n]):t[n].success(e[n])}},{key:"_xhrRequest",value:function(e,n){var r=this,o=t.getXhr();o.onload=function(){n(o.response||JSON.parse(o.responseText))},o.onerror=function(t){var i=null;try{i=o.response||JSON.parse(o.responseText)}catch(t){i={}}var s=new Error(i);s.status=o.status,r.emit("error",s,function(){r._xhrRequest(e,n)})};var i=Object.assign({},{requests:e},this._headers);this.emit("request",i),o.open("POST",this.server,!0),o.responseType="json",o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(i))}},{key:"_sendRequest",value:function(){var e=this,t=this._queue,n=t.map(function(e){return[e.name,e.args]});this._xhrRequest(n,function(r){if(e.emit("response"),!(r&&r instanceof Object&&r.responses instanceof Array))return e.emit("error",new Error("Invalid response from the server",n,r));for(var o in r)r.hasOwnProperty(o)&&("function"==typeof e["handle_"+o]?e["handle_"+o](r[o],t):e.emit(o,r[o],t))}),this._queue=[]}},{key:"setSessionId",value:function(e){return this._headers.session=e,this}},{key:"exec",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];"function"==typeof n&&(r=n,n=[]);var o=new a(function(r,o){t._queue.push({name:e,args:n,success:r,failure:o})});return"function"==typeof r&&(o.then(function(e){r(null,e)}),o["catch"](function(e){r(e,null)})),clearTimeout(this._sender),this._sender=setTimeout(function(){t._sendRequest()},this._wait),o}}]),t}(c);f.getXhr=function(){return new XMLHttpRequest},t.Client=f,t.Promise=a},function(e,t){function n(e,t,n){for(var r=0;r<e.length;r++)t.call(n,e[r])}function r(e,t){var n=e.indexOf(t);n!==-1&&e.splice(n,1)}function o(e,t){return e.indexOf(t)!==-1}function i(){this.listeners={}}function s(e){if("string"!=typeof e)throw"eventName is not a string"}function u(e){if("function"!=typeof e)throw"listener is not a function"}i.prototype.maxListeners=10,i.prototype.on=function(e,t){if(s(e),u(t),this.listeners[e]=this.listeners[e]||[],this.listeners[e].length>this.maxListeners)throw"Exceeded maxListeners - You might have a memory leak";return o(this.listeners[e],t)||(this.listeners[e].push(t),this.emit("on",{eventName:e,listener:t})),this},i.prototype.emit=function(e,t){s(e);var r=Array.prototype.slice.call(arguments,1);return n(this.listeners[e]||[],function(e){e.apply(this,r)},this),this},i.prototype.off=function(e,t){return s(e),u(t),r(this.listeners[e]||[],t),this.emit("off",{eventName:e,listener:t}),this},i.prototype.clearListeners=function(e){return s(e),this.listeners[e]=null,this},e.exports=i},function(e,t,n){(function(t){"use strict";function r(){}function o(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=w,this.queue=[],this.outcome=void 0,t.browser||(this.handled=b),e!==r&&c(this,e)}function i(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function s(e,t,n){v(function(){var r;try{r=t(n)}catch(o){return y.reject(e,o)}r===e?y.reject(e,new TypeError("Cannot resolve promise with itself")):y.resolve(e,r)})}function u(e){var t=e&&e.then;if(e&&"object"==typeof e&&"function"==typeof t)return function(){t.apply(e,arguments)}}function c(e,t){function n(t){i||(i=!0,y.reject(e,t))}function r(t){i||(i=!0,y.resolve(e,t))}function o(){t(r,n)}var i=!1,s=a(o);"error"===s.status&&n(s.value)}function a(e,t){var n={};try{n.value=e(t),n.status="success"}catch(r){n.status="error",n.value=r}return n}function f(e){return e instanceof this?e:y.resolve(new this(r),e)}function l(e){var t=new this(r);return y.reject(t,e)}function h(e){function t(e,t){function r(e){s[t]=e,++u!==o||i||(i=!0,y.resolve(a,s))}n.resolve(e).then(r,function(e){i||(i=!0,y.reject(a,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var o=e.length,i=!1;if(!o)return this.resolve([]);for(var s=new Array(o),u=0,c=-1,a=new this(r);++c<o;)t(e[c],c);return a}function p(e){function t(e){n.resolve(e).then(function(e){i||(i=!0,y.resolve(u,e))},function(e){i||(i=!0,y.reject(u,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var o=e.length,i=!1;if(!o)return this.resolve([]);for(var s=-1,u=new this(r);++s<o;)t(e[s]);return u}var v=n(4),y={},d=["REJECTED"],m=["FULFILLED"],w=["PENDING"];if(!t.browser)var b=["UNHANDLED"];e.exports=o,o.prototype["catch"]=function(e){return this.then(null,e)},o.prototype.then=function(e,n){if("function"!=typeof e&&this.state===m||"function"!=typeof n&&this.state===d)return this;var o=new this.constructor(r);if(t.browser||this.handled===b&&(this.handled=null),this.state!==w){var u=this.state===m?e:n;s(o,u,this.outcome)}else this.queue.push(new i(o,e,n));return o},i.prototype.callFulfilled=function(e){y.resolve(this.promise,e)},i.prototype.otherCallFulfilled=function(e){s(this.promise,this.onFulfilled,e)},i.prototype.callRejected=function(e){y.reject(this.promise,e)},i.prototype.otherCallRejected=function(e){s(this.promise,this.onRejected,e)},y.resolve=function(e,t){var n=a(u,t);if("error"===n.status)return y.reject(e,n.value);var r=n.value;if(r)c(e,r);else{e.state=m,e.outcome=t;for(var o=-1,i=e.queue.length;++o<i;)e.queue[o].callFulfilled(t)}return e},y.reject=function(e,n){e.state=d,e.outcome=n,t.browser||e.handled===b&&v(function(){e.handled===b&&t.emit("unhandledRejection",n,e)});for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callRejected(n);return e},o.resolve=f,o.reject=l,o.all=h,o.race=p}).call(t,n(3))},function(e,t){function n(){l&&a&&(l=!1,a.length?f=a.concat(f):h=-1,f.length&&r())}function r(){if(!l){var e=s(n);l=!0;for(var t=f.length;t;){for(a=f,f=[];++h<t;)a&&a[h].run();h=-1,t=f.length}a=null,l=!1,u(e)}}function o(e,t){this.fun=e,this.array=t}function i(){}var s,u,c=e.exports={};!function(){try{s=setTimeout}catch(e){s=function(){throw new Error("setTimeout is not defined")}}try{u=clearTimeout}catch(e){u=function(){throw new Error("clearTimeout is not defined")}}}();var a,f=[],l=!1,h=-1;c.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new o(e,t)),1!==f.length||l||s(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=i,c.addListener=i,c.once=i,c.off=i,c.removeListener=i,c.removeAllListeners=i,c.emit=i,c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},function(e,t,n){(function(t,n){"use strict";function r(){l=!0;for(var e,t,n=h.length;n;){for(t=h,h=[],e=-1;++e<n;)t[e]();n=h.length}l=!1}function o(e){1!==h.push(e)||l||i()}var i,s=t.MutationObserver||t.WebKitMutationObserver;if(n.browser)if(s){var u=0,c=new s(r),a=t.document.createTextNode("");c.observe(a,{characterData:!0}),i=function(){a.data=u=++u%2}}else if(t.setImmediate||"undefined"==typeof t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){r(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(r,0)};else{var f=new t.MessageChannel;f.port1.onmessage=r,i=function(){f.port2.postMessage(0)}}else i=function(){n.nextTick(r)};var l,h=[];e.exports=o}).call(t,function(){return this}(),n(3))}]);